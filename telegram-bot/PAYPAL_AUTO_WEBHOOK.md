# PayPal Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРѕРµ РїРѕРїРѕР»РЅРµРЅРёРµ С‡РµСЂРµР· Webhook

## Р§С‚Рѕ РёР·РјРµРЅРёР»РѕСЃСЊ

вњ… **РЈР±СЂР°РЅР°** РєРЅРѕРїРєР° "I paid вЂ” Confirm"  
вњ… **Р”РѕР±Р°РІР»РµРЅ** PayPal Webhook РґР»СЏ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРѕРіРѕ РїРѕРґС‚РІРµСЂР¶РґРµРЅРёСЏ РїР»Р°С‚РµР¶РµР№  
вњ… **Р”РѕР±Р°РІР»РµРЅР°** Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєР°СЏ РїСЂРѕРІРµСЂРєР° СЃС‚Р°С‚СѓСЃР° РЅР° С„СЂРѕРЅС‚РµРЅРґРµ  

РўРµРїРµСЂСЊ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ:
1. РќР°Р¶РёРјР°РµС‚ "Pay with PayPal"
2. РћРїР»Р°С‡РёРІР°РµС‚ РЅР° PayPal
3. Р’РѕР·РІСЂР°С‰Р°РµС‚СЃСЏ РІ РїСЂРёР»РѕР¶РµРЅРёРµ
4. Р‘Р°Р»Р°РЅСЃ РѕР±РЅРѕРІР»СЏРµС‚СЃСЏ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё (С‡РµСЂРµР· webhook РёР»Рё Р°РІС‚Рѕ-РїСЂРѕРІРµСЂРєСѓ)

---

## РќР°СЃС‚СЂРѕР№РєР° РЅР° СЃРµСЂРІРµСЂРµ

### 1. РћР±РЅРѕРІРёС‚Рµ РєРѕРґ

```bash
cd /root/cryp_land
git pull
cd telegram-bot
npm install  # РµСЃР»Рё Р±С‹Р»Рё РёР·РјРµРЅРµРЅРёСЏ РІ Р·Р°РІРёСЃРёРјРѕСЃС‚СЏС…
npm run build
pm2 restart syntrix
```

### 2. РќР°СЃС‚СЂРѕР№С‚Рµ PayPal Webhook

#### 2.1. Р—Р°Р№РґРёС‚Рµ РІ PayPal Developer Dashboard

1. РћС‚РєСЂРѕР№С‚Рµ: https://developer.paypal.com/dashboard/
2. Р’С‹Р±РµСЂРёС‚Рµ СЃРІРѕРµ РїСЂРёР»РѕР¶РµРЅРёРµ (С‚Рѕ, РѕС‚ РєРѕС‚РѕСЂРѕРіРѕ CLIENT_ID)
3. РџРµСЂРµР№РґРёС‚Рµ РІ СЂР°Р·РґРµР» **"Webhooks"**

#### 2.2. Р”РѕР±Р°РІСЊС‚Рµ Webhook

РќР°Р¶РјРёС‚Рµ **"Add Webhook"** Рё Р·Р°РїРѕР»РЅРёС‚Рµ:

**Webhook URL:**
```
https://api.syntrix.uno/api/paypal-webhook
```

**Event types** (РІС‹Р±РµСЂРёС‚Рµ СЌС‚Рё СЃРѕР±С‹С‚РёСЏ):
- вњ… `CHECKOUT.ORDER.APPROVED` - РєРѕРіРґР° РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РїРѕРґС‚РІРµСЂРґРёР» РѕРїР»Р°С‚Сѓ
- вњ… `PAYMENT.CAPTURE.COMPLETED` - РєРѕРіРґР° РїР»Р°С‚РµР¶ Р·Р°С…РІР°С‡РµРЅ (backup)

**РћРїС†РёРѕРЅР°Р»СЊРЅРѕ** (РґР»СЏ РґРѕРїРѕР»РЅРёС‚РµР»СЊРЅРѕРіРѕ Р»РѕРіРёСЂРѕРІР°РЅРёСЏ):
- `CHECKOUT.ORDER.COMPLETED`
- `PAYMENT.CAPTURE.DENIED`  
- `PAYMENT.CAPTURE.PENDING`

РќР°Р¶РјРёС‚Рµ **"Save"**.

#### 2.3. РџСЂРѕРІРµСЂСЊС‚Рµ Webhook

РџРѕСЃР»Рµ СЃРѕС…СЂР°РЅРµРЅРёСЏ PayPal РїРѕРєР°Р¶РµС‚ **Webhook ID**. РЎРѕС…СЂР°РЅРёС‚Рµ РµРіРѕ РґР»СЏ СЃРїСЂР°РІРєРё.

РџСЂРѕС‚РµСЃС‚РёСЂСѓР№С‚Рµ webhook:
1. Р’ PayPal Dashboard в†’ Webhooks в†’ РІС‹Р±РµСЂРёС‚Рµ РІР°С€ webhook
2. РќР°Р¶РјРёС‚Рµ **"Simulate Events"**
3. Р’С‹Р±РµСЂРёС‚Рµ СЃРѕР±С‹С‚РёРµ `CHECKOUT.ORDER.APPROVED`
4. РќР°Р¶РјРёС‚Рµ **"Send"**

РџСЂРѕРІРµСЂСЊС‚Рµ Р»РѕРіРё СЃРµСЂРІРµСЂР°:
```bash
pm2 logs syntrix --lines 50 | grep -i webhook
```

Р’С‹ РґРѕР»Р¶РЅС‹ СѓРІРёРґРµС‚СЊ:
```
рџ“Ё PayPal Webhook received
Webhook event type: CHECKOUT.ORDER.APPROVED
```

### 3. РћР±РЅРѕРІРёС‚Рµ С„СЂРѕРЅС‚РµРЅРґ

#### РђРІС‚РѕРјР°С‚РёС‡РµСЃРєРёР№ СЃРїРѕСЃРѕР± (СЂРµРєРѕРјРµРЅРґСѓРµС‚СЃСЏ):

```bash
cd /root/cryp_land
powershell ./apply-paypal-autopatch.ps1
# РР»Рё РЅР° Linux:
# bash apply-paypal-autopatch.sh
```

#### Р СѓС‡РЅРѕР№ СЃРїРѕСЃРѕР±:

1. РћС‚РєСЂРѕР№С‚Рµ `telegram-app/src/App.tsx`
2. РќР°Р№РґРёС‚Рµ С„СѓРЅРєС†РёСЋ `checkPayPalDepositStatus` - РѕРЅР° СѓР¶Рµ РґРѕР±Р°РІР»РµРЅР°
3. РќР°Р№РґРёС‚Рµ PayPal UI Р±Р»РѕРє (СЃС‚СЂРѕРєР° ~1126)
4. Р—Р°РјРµРЅРёС‚Рµ СЃС‚Р°СЂС‹Р№ РєРѕРґ:

```tsx
// РЈР”РђР›РРўР• Р­РўРћ:
<Button onClick={() => window.open(depositPaymentUrl, '_blank')}>
  Continue to PayPal
</Button>
<Button onClick={handlePayPalDepositConfirm}>
  I paid вЂ” Confirm
</Button>
```

РќР° РЅРѕРІС‹Р№:

```tsx
// РќРћР’Р«Р™ РљРћР”:
<Button
  onClick={async () => {
    window.open(depositPaymentUrl, '_blank')
    setTimeout(() => {
      let attempts = 0
      const maxAttempts = 20
      const checkInterval = setInterval(async () => {
        attempts++
        const completed = await checkPayPalDepositStatus(depositPaypalOrderId)
        if (completed || attempts >= maxAttempts) {
          clearInterval(checkInterval)
        }
      }, 6000)
    }, 5000)
  }}
>
  Pay with PayPal рџ‘‰
</Button>
<div className="flex items-center gap-2 p-3 bg-blue-500/10 rounded-lg">
  <span>в„№пёЏ</span>
  <p className="text-xs">
    After payment, return here. Balance updates automatically.
  </p>
</div>
<Button onClick={async () => {
  const completed = await checkPayPalDepositStatus(depositPaypalOrderId)
  if (!completed) toast.info('вЏі Payment still processing...')
}}>
  рџ”„ Check Status Now
</Button>
```

#### РЎРѕР±РµСЂРёС‚Рµ Рё Р·Р°РґРµРїР»РѕР№С‚Рµ:

```bash
cd telegram-app
npm run build

# Р•СЃР»Рё РёСЃРїРѕР»СЊР·СѓРµС‚Рµ Vercel/Netlify - РѕРЅРё СЃРѕР±РµСЂСѓС‚ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РїРѕСЃР»Рµ git push
# Р•СЃР»Рё РґРµРїР»РѕРёС‚Рµ РІСЂСѓС‡РЅСѓСЋ - СЃРєРѕРїРёСЂСѓР№С‚Рµ dist/ РЅР° СЃРµСЂРІРµСЂ
```

---

## РљР°Рє СЌС‚Рѕ СЂР°Р±РѕС‚Р°РµС‚

### РћСЃРЅРѕРІРЅРѕР№ flow (С‡РµСЂРµР· Webhook):

1. **РџРѕР»СЊР·РѕРІР°С‚РµР»СЊ СЃРѕР·РґР°РµС‚ РґРµРїРѕР·РёС‚** в†’ СЃРѕР·РґР°РµС‚СЃСЏ Р·Р°РїРёСЃСЊ РІ Р‘Р” СЃРѕ СЃС‚Р°С‚СѓСЃРѕРј `PENDING`
2. **РџРµСЂРµРЅР°РїСЂР°РІР»СЏРµС‚СЃСЏ РЅР° PayPal** в†’ РѕРїР»Р°С‡РёРІР°РµС‚
3. **PayPal РїРѕРґС‚РІРµСЂР¶РґР°РµС‚ РїР»Р°С‚РµР¶** в†’ РѕС‚РїСЂР°РІР»СЏРµС‚ webhook `CHECKOUT.ORDER.APPROVED`
4. **РЎРµСЂРІРµСЂ РїРѕР»СѓС‡Р°РµС‚ webhook** в†’ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РґРµР»Р°РµС‚ `capture` РїР»Р°С‚РµР¶Р°
5. **РџР»Р°С‚РµР¶ Р·Р°С…РІР°С‡РµРЅ** в†’ РѕР±РЅРѕРІР»СЏРµС‚СЃСЏ Р±Р°Р»Р°РЅСЃ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ, РѕС‚РїСЂР°РІР»СЏРµС‚СЃСЏ СѓРІРµРґРѕРјР»РµРЅРёРµ
6. **РџРѕР»СЊР·РѕРІР°С‚РµР»СЊ РІРѕР·РІСЂР°С‰Р°РµС‚СЃСЏ** в†’ РІРёРґРёС‚ РѕР±РЅРѕРІР»РµРЅРЅС‹Р№ Р±Р°Р»Р°РЅСЃ

### Backup flow (РµСЃР»Рё webhook РЅРµ СЃСЂР°Р±РѕС‚Р°Р»):

1. **РџРѕР»СЊР·РѕРІР°С‚РµР»СЊ РІРѕР·РІСЂР°С‰Р°РµС‚СЃСЏ** РІ РїСЂРёР»РѕР¶РµРЅРёРµ РїРѕСЃР»Рµ РѕРїР»Р°С‚С‹
2. **РђРІС‚РѕРјР°С‚РёС‡РµСЃРєРё Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ** РїСЂРѕРІРµСЂРєР° СЃС‚Р°С‚СѓСЃР° РєР°Р¶РґС‹Рµ 6 СЃРµРєСѓРЅРґ (20 СЂР°Р· = 2 РјРёРЅСѓС‚С‹)
3. **Р¤СЂРѕРЅС‚РµРЅРґ РїСЂРѕРІРµСЂСЏРµС‚** API `/api/user/{id}/deposits`
4. **Р•СЃР»Рё РїР»Р°С‚РµР¶ completed** в†’ РїРѕРєР°Р·С‹РІР°РµС‚ СѓРІРµРґРѕРјР»РµРЅРёРµ, РѕР±РЅРѕРІР»СЏРµС‚ Р±Р°Р»Р°РЅСЃ

### Р СѓС‡РЅР°СЏ РїСЂРѕРІРµСЂРєР°:

- РџРѕР»СЊР·РѕРІР°С‚РµР»СЊ РјРѕР¶РµС‚ РЅР°Р¶Р°С‚СЊ **"Check Status Now"**
- РўР°РєР¶Рµ РјРѕР¶РЅРѕ РѕР±РЅРѕРІРёС‚СЊ СЃС‚СЂР°РЅРёС†Сѓ вЂ” Р±Р°Р»Р°РЅСЃ РѕР±РЅРѕРІРёС‚СЃСЏ

---

## РўРµСЃС‚РёСЂРѕРІР°РЅРёРµ

### 1. Р›РѕРєР°Р»СЊРЅРѕРµ С‚РµСЃС‚РёСЂРѕРІР°РЅРёРµ webhook

Р”Р»СЏ С‚РµСЃС‚РёСЂРѕРІР°РЅРёСЏ webhook Р»РѕРєР°Р»СЊРЅРѕ РёСЃРїРѕР»СЊР·СѓР№С‚Рµ ngrok:

```bash
# РЈСЃС‚Р°РЅРѕРІРёС‚Рµ ngrok РµСЃР»Рё РЅРµС‚
npm install -g ngrok

# Р—Р°РїСѓСЃС‚РёС‚Рµ С‚СѓРЅРЅРµР»СЊ
ngrok http 3001

# РСЃРїРѕР»СЊР·СѓР№С‚Рµ URL РѕС‚ ngrok РІ PayPal Dashboard Webhook settings
# РќР°РїСЂРёРјРµСЂ: https://abc123.ngrok.io/api/paypal-webhook
```

Р—Р°С‚РµРј СЃРґРµР»Р°Р№С‚Рµ С‚РµСЃС‚РѕРІС‹Р№ РїР»Р°С‚РµР¶ РІ sandbox.

### 2. РџСЂРѕРІРµСЂРєР° РІ sandbox

1. РЈР±РµРґРёС‚РµСЃСЊ, С‡С‚Рѕ `PAYPAL_ENV=sandbox` РІ `.env`
2. РЎРѕР·РґР°Р№С‚Рµ РґРµРїРѕР·РёС‚ С‡РµСЂРµР· Р±РѕС‚Р°
3. РќР° PayPal sandbox СЃС‚СЂР°РЅРёС†Рµ РІРѕР№РґРёС‚Рµ СЃ С‚РµСЃС‚РѕРІС‹Рј Р°РєРєР°СѓРЅС‚РѕРј
4. РџРѕРґС‚РІРµСЂРґРёС‚Рµ РїР»Р°С‚РµР¶
5. РџСЂРѕРІРµСЂСЊС‚Рµ Р»РѕРіРё:

```bash
pm2 logs syntrix | grep -i paypal
```

Р”РѕР»Р¶РЅРѕ Р±С‹С‚СЊ:
```
рџ“Ё PayPal Webhook received
вњ… Order XXX approved, attempting auto-capture...
вњ… Payment captured successfully
рџЋ‰ Deposit completed automatically for user 123456
```

### 3. РџСЂРѕРІРµСЂРєР° РІ production

РџРѕСЃР»Рµ РїРµСЂРµРєР»СЋС‡РµРЅРёСЏ РЅР° `PAYPAL_ENV=live`:

1. РЎРґРµР»Р°Р№С‚Рµ СЂРµР°Р»СЊРЅС‹Р№ С‚РµСЃС‚РѕРІС‹Р№ РїР»Р°С‚РµР¶ ($1)
2. РџСЂРѕРІРµСЂСЊС‚Рµ, С‡С‚Рѕ webhook СЃСЂР°Р±Р°С‚С‹РІР°РµС‚
3. РџСЂРѕРІРµСЂСЊС‚Рµ, С‡С‚Рѕ Р±Р°Р»Р°РЅСЃ РѕР±РЅРѕРІР»СЏРµС‚СЃСЏ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё
4. РџСЂРѕРІРµСЂСЊС‚Рµ СѓРІРµРґРѕРјР»РµРЅРёСЏ РїРѕР»СЊР·РѕРІР°С‚РµР»СЋ Рё Р°РґРјРёРЅР°Рј

---

## Troubleshooting

### Webhook РЅРµ СЂР°Р±РѕС‚Р°РµС‚

**РџСЂРѕРІРµСЂСЊС‚Рµ:**

```bash
# 1. Webhook URL РґРѕСЃС‚СѓРїРµРЅ РёР·РІРЅРµ
curl https://api.syntrix.uno/api/paypal-webhook
# Р”РѕР»Р¶РµРЅ РІРµСЂРЅСѓС‚СЊ 200 OK РёР»Рё РѕС€РёР±РєСѓ (РЅРѕ РЅРµ timeout)

# 2. Р›РѕРіРё СЃРµСЂРІРµСЂР°
pm2 logs syntrix --lines 100 | grep webhook

# 3. PayPal Dashboard в†’ Webhooks в†’ РІР°С€ webhook в†’ Recent deliveries
# РўР°Рј Р±СѓРґРµС‚ РёСЃС‚РѕСЂРёСЏ РІСЃРµС… РѕС‚РїСЂР°РІР»РµРЅРЅС‹С… webhooks Рё РёС… СЃС‚Р°С‚СѓСЃС‹
```

**Р§Р°СЃС‚С‹Рµ РїСЂРѕР±Р»РµРјС‹:**

- вќЊ **404 Not Found** в†’ РїСЂРѕРІРµСЂСЊС‚Рµ URL, СѓР±РµРґРёС‚РµСЃСЊ С‡С‚Рѕ РїСѓС‚СЊ РїСЂР°РІРёР»СЊРЅС‹Р№
- вќЊ **500 Server Error** в†’ РїСЂРѕРІРµСЂСЊС‚Рµ Р»РѕРіРё СЃРµСЂРІРµСЂР°, РІРѕР·РјРѕР¶РЅР° РѕС€РёР±РєР° РІ РєРѕРґРµ
- вќЊ **Timeout** в†’ СЃРµСЂРІРµСЂ РЅРµ РѕС‚РІРµС‡Р°РµС‚, РїСЂРѕРІРµСЂСЊС‚Рµ С‡С‚Рѕ РѕРЅ Р·Р°РїСѓС‰РµРЅ Рё РґРѕСЃС‚СѓРїРµРЅ
- вќЊ **SSL Error** в†’ СѓР±РµРґРёС‚РµСЃСЊ С‡С‚Рѕ РёСЃРїРѕР»СЊР·СѓРµС‚Рµ HTTPS

### РђРІС‚РѕРїСЂРѕРІРµСЂРєР° РЅРµ СЂР°Р±РѕС‚Р°РµС‚

**РџСЂРѕРІРµСЂСЊС‚Рµ РІ Р±СЂР°СѓР·РµСЂРµ (Developer Tools в†’ Console):**

```javascript
// Р”РѕР»Р¶РЅР° Р±С‹С‚СЊ С„СѓРЅРєС†РёСЏ checkPayPalDepositStatus
// РџСЂРѕРІРµСЂСЊС‚Рµ, РЅРµС‚ Р»Рё РѕС€РёР±РѕРє JavaScript
```

**РџСЂРѕРІРµСЂСЊС‚Рµ API endpoint:**

```bash
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  https://api.syntrix.uno/api/user/YOUR_TELEGRAM_ID/deposits
```

### Р‘Р°Р»Р°РЅСЃ РЅРµ РѕР±РЅРѕРІР»СЏРµС‚СЃСЏ

**РџСЂРѕРІРµСЂСЊС‚Рµ Р»РѕРіРё:**

```bash
pm2 logs syntrix | grep -A 10 "Order.*approved"
```

**РџСЂРѕРІРµСЂСЊС‚Рµ Р‘Р”:**

```bash
# Р—Р°Р№РґРёС‚Рµ РІ Prisma Studio РёР»Рё РїСЂРѕРІРµСЂСЊС‚Рµ С‡РµСЂРµР· SQL
# РЎС‚Р°С‚СѓСЃ РґРµРїРѕР·РёС‚Р° РґРѕР»Р¶РµРЅ Р±С‹С‚СЊ COMPLETED
```

**РџСЂРѕРІРµСЂСЊС‚Рµ user balance:**

```bash
# Р’ Р»РѕРіР°С… РґРѕР»Р¶РЅРѕ Р±С‹С‚СЊ:
# "totalDeposit increment by X"
```

---

## РћС‚РєР°С‚ РёР·РјРµРЅРµРЅРёР№

Р•СЃР»Рё РЅСѓР¶РЅРѕ РІРµСЂРЅСѓС‚СЊ СЃС‚Р°СЂСѓСЋ Р»РѕРіРёРєСѓ СЃ РєРЅРѕРїРєРѕР№ "Confirm":

### Backend:

Р—Р°РєРѕРјРјРµРЅС‚РёСЂСѓР№С‚Рµ webhook endpoint РІ `api.ts`:

```typescript
// app.post('/api/paypal-webhook', ... )
```

### Frontend:

Р’РµСЂРЅРёС‚Рµ СЃС‚Р°СЂС‹Р№ РєРѕРґ:

```tsx
<Button onClick={() => window.open(depositPaymentUrl, '_blank')}>
  Continue to PayPal
</Button>
<Button onClick={handlePayPalDepositConfirm}>
  I paid вЂ” Confirm
</Button>
```

РЎРѕР±РµСЂРёС‚Рµ Рё Р·Р°РґРµРїР»РѕР№С‚Рµ.

---

## РњРѕРЅРёС‚РѕСЂРёРЅРі

### РџСЂРѕРІРµСЂРєР° СЂР°Р±РѕС‚С‹ webhook:

```bash
# РЎРјРѕС‚СЂРёС‚Рµ Р»РѕРіРё СЂРµР°Р»СЊРЅРѕРіРѕ РІСЂРµРјРµРЅРё
pm2 logs syntrix --lines 0

# Р¤РёР»СЊС‚СЂСѓР№С‚Рµ С‚РѕР»СЊРєРѕ PayPal СЃРѕР±С‹С‚РёСЏ
pm2 logs syntrix | grep -i paypal

# РЎС‚Р°С‚РёСЃС‚РёРєР° СѓСЃРїРµС€РЅС‹С… РґРµРїРѕР·РёС‚РѕРІ
pm2 logs syntrix | grep "Deposit completed automatically" | wc -l
```

### PayPal Dashboard:

1. Р—Р°Р№РґРёС‚Рµ РІ PayPal Developer Dashboard
2. Webhooks в†’ РІР°С€ webhook
3. **Recent deliveries** РїРѕРєР°Р¶РµС‚:
   - РљР°РєРёРµ СЃРѕР±С‹С‚РёСЏ Р±С‹Р»Рё РѕС‚РїСЂР°РІР»РµРЅС‹
   - РЎС‚Р°С‚СѓСЃ РѕС‚РІРµС‚Р° РІР°С€РµРіРѕ СЃРµСЂРІРµСЂР°
   - Retry attempts (РµСЃР»Рё Р±С‹Р»Рё)

---

## РџСЂРµРёРјСѓС‰РµСЃС‚РІР° РЅРѕРІРѕРіРѕ РїРѕРґС…РѕРґР°

вњ… **Р›СѓС‡С€РёР№ UX** - РїРѕР»СЊР·РѕРІР°С‚РµР»СЋ РЅРµ РЅСѓР¶РЅРѕ РЅРёС‡РµРіРѕ РїРѕРґС‚РІРµСЂР¶РґР°С‚СЊ РІСЂСѓС‡РЅСѓСЋ  
вњ… **Р‘С‹СЃС‚СЂРµРµ** - Р±Р°Р»Р°РЅСЃ РѕР±РЅРѕРІР»СЏРµС‚СЃСЏ СЃСЂР°Р·Сѓ РїРѕСЃР»Рµ РѕРїР»Р°С‚С‹ С‡РµСЂРµР· webhook  
вњ… **РќР°РґРµР¶РЅРµРµ** - РµСЃС‚СЊ backup С‡РµСЂРµР· Р°РІС‚РѕРїСЂРѕРІРµСЂРєСѓ, РµСЃР»Рё webhook РЅРµ СЃСЂР°Р±РѕС‚Р°Р»  
вњ… **РњРµРЅСЊС€Рµ РѕС€РёР±РѕРє** - РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РЅРµ РјРѕР¶РµС‚ РЅР°Р¶Р°С‚СЊ "Confirm" РґРѕ РѕРїР»Р°С‚С‹  
вњ… **РњРµРЅСЊС€Рµ РїРѕРґРґРµСЂР¶РєРё** - РјРµРЅСЊС€Рµ РІРѕРїСЂРѕСЃРѕРІ "СЏ РѕРїР»Р°С‚РёР», РЅРѕ Р±Р°Р»Р°РЅСЃ РЅРµ РїСЂРёС€РµР»"  

## Р‘РµР·РѕРїР°СЃРЅРѕСЃС‚СЊ

Webhook endpoint РѕС‚РєСЂС‹С‚ (РЅРµ С‚СЂРµР±СѓРµС‚ Р°РІС‚РѕСЂРёР·Р°С†РёРё), РЅРѕ СЌС‚Рѕ Р±РµР·РѕРїР°СЃРЅРѕ РїРѕС‚РѕРјСѓ С‡С‚Рѕ:

1. **РџСЂРѕРІРµСЂСЏРµС‚СЃСЏ order ID** - СЃРѕР·РґР°РµС‚СЃСЏ С‚РѕР»СЊРєРѕ С‡РµСЂРµР· РЅР°С€ API
2. **Capture Р·Р°РїСЂРѕСЃ РёРґРµС‚ СЃ РЅР°С€РµРіРѕ СЃРµСЂРІРµСЂР°** - РёСЃРїРѕР»СЊР·СѓСЏ РЅР°С€ access token
3. **PayPal РїРѕРґРїРёСЃС‹РІР°РµС‚ webhooks** - РјРѕР¶РЅРѕ РґРѕР±Р°РІРёС‚СЊ РїСЂРѕРІРµСЂРєСѓ РїРѕРґРїРёСЃРё (РѕРїС†РёРѕРЅР°Р»СЊРЅРѕ)
4. **РЎСѓРјРјР° РІР°Р»РёРґРёСЂСѓРµС‚СЃСЏ** - capture РЅРµ РїСЂРѕР№РґРµС‚ РµСЃР»Рё СЃСѓРјРјР° РЅРµРІРµСЂРЅР°СЏ

Р”Р»СЏ РґРѕРїРѕР»РЅРёС‚РµР»СЊРЅРѕР№ Р·Р°С‰РёС‚С‹ РјРѕР¶РЅРѕ РґРѕР±Р°РІРёС‚СЊ РїСЂРѕРІРµСЂРєСѓ PayPal РїРѕРґРїРёСЃРё webhook (СЃРј. РґРѕРєСѓРјРµРЅС‚Р°С†РёСЋ PayPal).

---

**Р“РѕС‚РѕРІРѕ!** РўРµРїРµСЂСЊ PayPal РїР»Р°С‚РµР¶Рё СЂР°Р±РѕС‚Р°СЋС‚ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё Р±РµР· РЅРµРѕР±С…РѕРґРёРјРѕСЃС‚Рё СЂСѓС‡РЅРѕРіРѕ РїРѕРґС‚РІРµСЂР¶РґРµРЅРёСЏ. рџЋ‰


