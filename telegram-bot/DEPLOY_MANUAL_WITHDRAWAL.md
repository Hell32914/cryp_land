# Quick Deploy: Ручная система вывода средств

## Быстрая инструкция по деплою изменений

### Что изменено:
- ✅ Отключен автоматический вывод через PayPal и OxaPay
- ✅ Добавлен ручной процесс обработки выводов админами
- ✅ Добавлен новый статус `APPROVED` для одобренных заявок
- ✅ Добавлена кнопка "Mark as Completed" для админов

---

## Шаги для деплоя:

### 1. Остановить текущий сервис

```bash
pm2 stop telegram-bot
# или
sudo systemctl stop syntrix.service
```

### 2. Перейти в директорию проекта

```bash
cd /root/cryp_land/telegram-bot
# или
cd d:\my_repo\cryp_land\telegram-bot
```

### 3. Получить изменения

```bash
git pull origin main
```

### 4. Пересобрать проект

```bash
npm run build
```

### 5. Запустить сервис

```bash
pm2 start ecosystem.config.json
pm2 save
# или
sudo systemctl start syntrix.service
```

### 6. Проверить работу

```bash
pm2 logs telegram-bot --lines 50
# или
journalctl -u syntrix.service -f
```

---

## Проверка работы:

1. **Telegram бот запущен**
   - Команда `/admin` работает
   - Админ-панель загружается

2. **Создать тестовую заявку на вывод**
   - Зайти в мини-приложение
   - Запросить минимальный вывод ($10)
   - Проверить, что баланс уменьшился

3. **Проверить уведомление админа**
   - Админ должен получить уведомление
   - Кнопки `✅ Approve` и `❌ Reject` должны быть видны

4. **Одобрить заявку**
   - Нажать `✅ Approve & Process`
   - Должна появиться инструкция для ручного перевода
   - Кнопка `✅ Mark as Completed` должна быть видна

5. **Отметить как выполнено**
   - Нажать `✅ Mark as Completed`
   - Пользователь должен получить уведомление о завершении

---

## В случае проблем:

### Бот не запускается:

```bash
# Проверить логи
pm2 logs telegram-bot --lines 100

# Проверить ошибки сборки
npm run build

# Очистить и пересобрать
rm -rf dist
npm run build
```

### Уведомления не приходят:

```bash
# Проверить, что бот работает
pm2 status

# Перезапустить
pm2 restart telegram-bot
```

### Кнопки не работают:

- Проверить, что изменения применены: `git log --oneline -5`
- Убедиться, что `npm run build` выполнилась успешно
- Перезапустить бота: `pm2 restart telegram-bot`

---

## Откат изменений (если нужно):

### Вернуться к предыдущей версии:

```bash
git log --oneline -5  # Найти commit до изменений
git checkout <COMMIT_HASH>
npm run build
pm2 restart telegram-bot
```

### Или временно отключить:

Можно вручную вернуть старый код из Git истории, но проще просто откатиться на предыдущий commit.

---

## Документация:

Полная документация находится в файле [MANUAL_WITHDRAWAL_SYSTEM.md](./MANUAL_WITHDRAWAL_SYSTEM.md)

---

**Дата внедрения:** 2 января 2026  
**Автор:** GitHub Copilot
