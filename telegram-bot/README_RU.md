# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –ø—Ä–æ—Ñ–∏—Ç–æ–≤ –∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Supabase.

### –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã:
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å —Å–æ–∑–¥–∞–≤–∞–ª —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä PrismaClient
- –≠—Ç–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –º–æ–≥–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î (—Å—Ç–∞—Ä–æ–µ SQLite –≤–º–µ—Å—Ç–æ –Ω–æ–≤–æ–≥–æ Supabase)

### –†–µ—à–µ–Ω–∏–µ:
‚úÖ –°–æ–∑–¥–∞–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å `src/db.ts` —Å –µ–¥–∏–Ω—ã–º PrismaClient
‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

## üöÄ –ß–¢–û –î–ï–õ–ê–¢–¨ –î–ê–õ–¨–®–ï:

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç–µ DATABASE_URL –≤ .env

**–ù–ê –õ–û–ö–ê–õ–¨–ù–û–ô –ú–ê–®–ò–ù–ï** (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):
```env
# –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª .env –∏ –∑–∞–º–µ–Ω–∏—Ç–µ:
DATABASE_URL="file:./dev.db"

# –ù–∞ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Supabase:
DATABASE_URL="postgresql://postgres.[project-ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres?pgbouncer=true"
```

**–ù–ê –°–ï–†–í–ï–†–ï** (Railway/production):
```bash
# –ß–µ—Ä–µ–∑ Railway Dashboard:
# Settings ‚Üí Variables ‚Üí –î–æ–±–∞–≤—å—Ç–µ/–æ–±–Ω–æ–≤–∏—Ç–µ DATABASE_URL

# –ò–ª–∏ —á–µ—Ä–µ–∑ Railway CLI:
railway variables set DATABASE_URL="postgresql://..."
```

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Supabase

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Database**
4. –ù–∞–π–¥–∏—Ç–µ **Connection string** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ **Connection pooling** (—Ä–µ–∂–∏–º Transaction)
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –∏ –∑–∞–º–µ–Ω–∏—Ç–µ `[YOUR-PASSWORD]` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –ë–î

–ü—Ä–∏–º–µ—Ä:
```
postgresql://postgres.abcdefghijklmnop:–≤–∞—à_–ø–∞—Ä–æ–ª—å@aws-0-eu-central-1.pooler.supabase.com:6543/postgres?pgbouncer=true
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ù–ê –õ–û–ö–ê–õ–¨–ù–û–ô –ú–ê–®–ò–ù–ï (Windows):**
```powershell
# 1. –û–±–Ω–æ–≤–∏—Ç–µ .env (—Å–º. –®–∞–≥ 1)
# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ PowerShell:
.\update-supabase-fix.ps1
```

**–ù–ê –°–ï–†–í–ï–†–ï (Linux/Railway):**
```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
# 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –±–æ—Ç–∞:
cd /path/to/telegram-bot

# 3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
git pull origin main

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:
chmod +x update-supabase-fix.sh
./update-supabase-fix.sh
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:
npm run db:check

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
pm2 logs telegram-bot --lines 30
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Database connection successful!
- ‚úÖ Trading card scheduler initialized
- ‚úÖ Trading card sent to X/Y users
- ‚úÖ Sent profit notification to user...

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

‚úÖ **src/db.ts** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π PrismaClient
‚úÖ **check-db-connection.js** - —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ë–î (–∑–∞–ø—É—Å–∫: `npm run db:check`)
‚úÖ **update-supabase-fix.sh** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è Linux
‚úÖ **update-supabase-fix.ps1** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è Windows
‚úÖ **FIX_SUPABASE_CONNECTION.md** - –ø–æ–¥—Ä–æ–±–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚úÖ **SUMMARY.md** - —Ä–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚úÖ **QUICKSTART_FIX.md** - –±—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
‚úÖ **README_RU.md** - —ç—Ç–æ—Ç —Ñ–∞–π–ª

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û:

1. **DATABASE_URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º** –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Connection Pooling** (—Ä–µ–∂–∏–º Transaction) –æ—Ç Supabase
3. **–ù–ï –ø—É–±–ª–∏–∫—É–π—Ç–µ** DATABASE_URL –≤ Git (–æ–Ω –≤ .gitignore)
4. –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DATABASE_URL **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞**

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–æ—Ñ–∏—Ç—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:
npm run db:check

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ pending notifications:
node check-db-connection.js

# 3. –ï—Å–ª–∏ –µ—Å—Ç—å pending notifications, –æ–Ω–∏ –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
pm2 logs telegram-bot | grep "Trading card"

# 2. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
# "üìä Trading card scheduler initialized"
# "‚úÖ Trading card #X sent to Y/Z users"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL:
echo $DATABASE_URL  # Linux
$env:DATABASE_URL   # PowerShell

# 2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç "postgresql://" –∞ –Ω–µ "file:"
# 3. –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ Prisma:
npx prisma generate
npm run build
pm2 restart all
```

---

## üìû –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ DATABASE_URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (postgres, –∞ –Ω–µ sqlite)
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `npm run db:check` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `pm2 logs telegram-bot --lines 50`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ Supabase (DailyProfitUpdate, TradingPost, User)
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

---

## ‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:
- ‚úÖ –ü—Ä–æ—Ñ–∏—Ç—ã –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ –¢–æ—Ä–≥–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ –í—Å—ë –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å Supabase

**–£–¥–∞—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è! üöÄ**
