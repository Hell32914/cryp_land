# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ—Ñ–∏—Ç–∞–º–∏ –∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏

## üéØ –°—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ Supabase PostgreSQL –ø—Ä–æ—Ñ–∏—Ç—ã –∏ —Ç–æ—Ä–≥–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å (–≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞), –Ω–æ **–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º** –≤ Telegram –±–æ—Ç.

## üîç –ü—Ä–∏—á–∏–Ω–∞

–í –∫–æ–¥–µ –±—ã–ª–æ **–Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ PrismaClient**:
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å (`cardGenerator.ts`, `tradingCardScheduler.ts`, `api.ts` –∏ –¥—Ä.) —Å–æ–∑–¥–∞–≤–∞–ª —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `new PrismaClient()`
- –≠—Ç–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –º–æ–≥–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- –ü—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Supabase –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä–æ–µ SQLite –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π PrismaClient

–°–æ–∑–¥–∞–Ω –µ–¥–∏–Ω—ã–π –º–æ–¥—É–ª—å `src/db.ts`:
```typescript
import { PrismaClient } from '@prisma/client'

export const prisma = new PrismaClient({
  log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error']
})
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã

–í—Å–µ —Ñ–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä:
- ‚úÖ `src/index.ts`
- ‚úÖ `src/cardGenerator.ts`
- ‚úÖ `src/tradingCardScheduler.ts`
- ‚úÖ `src/api.ts`
- ‚úÖ `src/payoutStatusChecker.ts`

### 3. –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

- `check-db-connection.js` - —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- `npm run db:check` - –±—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:

```powershell
# 1. –û–±–Ω–æ–≤–∏—Ç–µ .env —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º DATABASE_URL –æ—Ç Supabase
# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
.\update-supabase-fix.ps1
```

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (Linux):

```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ DATABASE_URL —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ Supabase
# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
chmod +x update-supabase-fix.sh
./update-supabase-fix.sh
```

### –í—Ä—É—á–Ω—É—é:

```bash
npm install
npm run build
npm run db:check  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
npm start         # –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
```

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ DATABASE_URL

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ DATABASE_URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π!

### ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (SQLite):
```env
DATABASE_URL="file:./dev.db"
```

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ (Supabase PostgreSQL):
```env
DATABASE_URL="postgresql://postgres.[project-ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres?pgbouncer=true"
```

### –ì–¥–µ –≤–∑—è—Ç—å —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
1. –ó–∞–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å Supabase ‚Üí –í–∞—à –ø—Ä–æ–µ–∫—Ç
2. Settings ‚Üí Database
3. Connection string ‚Üí **Connection pooling** (—Ä–µ–∂–∏–º Transaction)
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –∏ –∑–∞–º–µ–Ω–∏—Ç–µ `[YOUR-PASSWORD]` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:
```bash
npm run db:check
```

–î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏:
- ‚úÖ Database connection successful
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º
- üîî –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ pending notifications

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
pm2 logs telegram-bot --lines 50
```

–ò—â–∏—Ç–µ:
- ‚úÖ "üìä Trading card scheduler initialized"
- ‚úÖ "‚úÖ Trading card #X sent to Y/Z users"
- ‚úÖ "üì§ Sent profit notification to user..."

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±–æ—Ç–µ:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∞—Ç—å –ø—Ä–æ—Ñ–∏—Ç—ã
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∞—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏

## üîß –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞—ë—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**:
   ```bash
   echo $DATABASE_URL  # Linux
   $env:DATABASE_URL   # PowerShell
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase**:
   - –ó–∞–π–¥–∏—Ç–µ –≤ Supabase Dashboard ‚Üí Table Editor
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü—ã: User, DailyProfitUpdate, TradingPost

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞**:
   - –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞

4. **–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ Prisma Client**:
   ```bash
   npx prisma generate
   npm run build
   ```

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ pending notifications**:
   ```bash
   npm run db:check
   ```
   –ï—Å–ª–∏ –µ—Å—Ç—å pending notifications, –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ –º–∏–Ω—É—Ç—ã

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- ‚úÖ `src/db.ts` - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π PrismaClient
- ‚úÖ `check-db-connection.js` - —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ë–î
- ‚úÖ `update-supabase-fix.sh` - —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è Linux
- ‚úÖ `update-supabase-fix.ps1` - —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è Windows
- ‚úÖ `FIX_SUPABASE_CONNECTION.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase
- ‚úÖ –ü—Ä–æ—Ñ–∏—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ –¢–æ—Ä–≥–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
- ‚úÖ –õ–µ–≥–∫–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ë–î

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π prisma**:
   ```typescript
   import { prisma } from './db.js'
   ```

2. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**:
   ```bash
   npm run db:check
   ```

3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏**:
   ```bash
   pm2 logs telegram-bot
   ```

4. **–î–µ—Ä–∂–∏—Ç–µ .env –∞–∫—Ç—É–∞–ª—å–Ω—ã–º** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ DATABASE_URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 10 –¥–µ–∫–∞–±—Ä—è 2024
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é
